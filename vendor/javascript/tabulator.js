// tabulator@0.2.40 downloaded from https://ga.jspm.io/npm:tabulator@0.2.40/tabulator.js

import a from"codenautas-xlsx";import r from"like-ar";import t from"best-globals";import e from"js-to-html";var l={};(function webpackUniversalModuleDefinition(a,r){"string"!==typeof a.globalModuleName&&(a.globalModuleName=r.name);l=r();a.globalModuleName=null})(l,(function Tabulator(){"undefined"!==typeof window&&(window.require.definedModules["codenautas-xlsx"]=window.XLSX);var l=a;var n=r;var i=t;var o=e.html;var Tabulator=function(){};function array_combine(a,r){var t={};for(var e=0;e<a.length;e++)t[a[e]]=r[e];return t}Tabulator.prototype.captionPart=function captionPart(a){return a.caption?o.caption(a.caption):null};Tabulator.prototype.colGroups=function colGroups(a){var r=a.lineVariables?o.colgroup({class:"headers"},a.lineVariables.map((function(a){return o.col({class:a})}))):null;var t=a.columns?o.colgroup({class:"data"},a.oneColumnTitle?o.col({class:"variable"}):a.columns.map((function(r){return o.col({class:JSON.stringify(array_combine(a.columnVariables,r.titles))})}))):null;return[].concat(r,t)};function labelVariableValues(a,r,t){return((((a.vars||{})[r]||{}).values||{})[t]||{}).label||t}function flatArray(a){return[].concat.apply([],a)}Tabulator.prototype.toCellColumnHeader=function toCellColumnHeader(a,r,t,e){return o.th(a,t)};Tabulator.prototype.tHeadPart=function tHeadPart(a){var r=this;if(!a.columnVariables)return null;function labelVariable(r){return((a.vars||{})[r]||{}).label||r}var t=a.columns.length>0?{class:"variable",colspan:a.columns.length}:{class:"variable",rowspan:2};return o.thead([o.tr(a.lineVariables.map((function(r){var t=a.columnVariables.length>0?a.columnVariables.length:1;return o.th({class:"variable",rowspan:2*t},labelVariable(r))})).concat(o.th(t,labelVariable(a.columnVariables[0])||a.oneColumnTitle)))].concat(flatArray(a.columnVariables.map((function(t,e){var l=[];var n=[];var i="none";var s=1;function updateColspan(){if(s>1){m.colspan=s;d.colspan=s}}for(var u=0;u<a.columns.length;u++){var c=a.columns[u].titles;var v=c.slice(0,e+1);var f=JSON.stringify(v);if(f!=i){updateColspan();var b=a.columnVariables[e];var p=c[e];var h=labelVariableValues(a,b,p);var m={class:"var_"+b};l.push(r.toCellColumnHeader(m,b,h,p));if(e+1<a.columnVariables.length){var d={class:"variable"};n.push(o.th(d,labelVariable(a.columnVariables[e+1])))}i=f;s=0}s++}updateColspan();return e+1<a.columnVariables.length?[o.tr(l),o.tr(n)]:[o.tr(l)]})))))};Tabulator.prototype.defaultShowAttribute="show";Tabulator.prototype.toCellTable=function(a,r){return a instanceof Object?o.td(n(a).filter((function(a,r){return/-/.test(r)})).plain(),a[this.defaultShowAttribute]):o.td(a)};Tabulator.prototype.tBodyPart=function tBodyPart(a){var r=[];var t=[];var e=[];for(var l=0;l<a.lines.length;l++){var s=a.lines[l];var u=s.titles;var c=[];var v=a.lines[l].cells;var f=a.lineVariables&&s.titles?n.toPlainObject(a.lineVariables,s.titles):{};var b=v.map((function(r,t){var e=a.columnVariables&&a.columns&&a.columns[t]?n.toPlainObject(a.columnVariables,a.columns[t].titles):{};return this.toCellTable(r,i.changing(f,e))}),this);if(u){for(var p=0;p<u.length;p++){var h=(a.lineVariables||{})[p]||null;var m=u.slice(0,p+1);var d=t.slice(0,p+1);if(JSON.stringify(m)!=JSON.stringify(d)){e[p]={};(a.lineVariables||{})[p]&&(e[p]["class"]="var_"+(a.lineVariables||{})[p]);c.push(o.th(e[p],labelVariableValues(a,h,u[p])))}else e[p].rowspan=(e[p].rowspan||1)+1}t=u}r.push(o.tr(c.concat(b)))}return o.tbody(r)};Tabulator.prototype.toExcel=function toExcel(a,r){var t="xlsx";var e=l.utils.table_to_book(a,{sheet:"Tabulado"});e.SheetNames.push("Ficha");var n;n={B2:{t:"s",v:"Fecha:"},C2:{t:"s",v:new Date(Date.now()).toLocaleString()},B3:{t:"s",v:"Indicador:"},C3:{t:"s",v:r.filename},B4:{t:"s",v:"Enlace:"},C4:{t:"s",v:window.location.href}};if(r.username){n.B1={t:"s",v:"usuario"};n.C1={t:"s",v:r.username}}n["!ref"]="A1:D50";e.Sheets["Ficha"]=n;var i=l.write(e,{bookType:t,bookSST:true,type:"binary"});var o=r.filename+"."+t;try{var s=new Blob([s2ab(i)],{type:"application/octet-stream"});saveAs(s,o)}catch(a){"undefined"!=typeof console&&console.log(a,i)}return i};function s2ab(a){if("undefined"!==typeof ArrayBuffer){var r=new ArrayBuffer(a.length);var t=new Uint8Array(r);for(var e=0;e!=a.length;++e)t[e]=255&a.charCodeAt(e);return r}var r=new Array(a.length);for(var e=0;e!=a.length;++e)r[e]=255&a.charCodeAt(e);return r}Tabulator.prototype.toHtmlTable=function toHtmlTable(a){this.controls(a);return o.table({class:"tabulator-table"},[].concat(this.captionPart(a),this.colGroups(a),this.tHeadPart(a),this.tBodyPart(a)))};Tabulator.prototype.controls=function controls(a){var r=a.lineVariables;var t=a.lines;var e=a.columnVariables;var l=a.columns;e&&l&&variableExistanceAndQuantity(e,l,"columnVariables");r&&t&&variableExistanceAndQuantity(r,t,"lineVariables");l&&t&&cellExistanceAndQuantity(l,t,"cells");function variableExistanceAndQuantity(a,r,t){var e="columnVariables"==t?"column ":"line ";var l=a.length;for(var n=0;n<r.length;n++){if(!r[n].titles)throw new Error("there are no titles in "+e+n+" but "+t+" exists");if(r[n].titles.length!=l)throw new Error(e+n+" has "+r[n].titles.length+" values but "+t+" has "+l)}}function cellExistanceAndQuantity(a,r,t){var e=a.length||1;for(var l=0;l<r.length;l++){if(!(r[l].cells.length>0))throw new Error("there are no cells in line "+l+" but columns exists");if(r[l].cells.length!=e)throw new Error("line "+l+" has "+r[l].cells.length+" cells but columns has "+e)}}};Tabulator.prototype.controlsJoin=function controlsJoin(a){var r=a[0].lines.length;if(!a.every((function(a){return a.lines.length==r})))throw new Error("line.length does not match in all matrix");var t=a[0].lines;var e=t.map((function(a){return JSON.stringify(a.titles)}));if(!a.every((function(a,r){return a.lines.every((function(a,r){return e.indexOf(JSON.stringify(a.titles))>-1}))})))throw new Error("line titles does not match in all matrix")};Tabulator.prototype.getZMatrices=function getZMatrices(a,r){var t=a.list.map((function(a){return a[r.name]}));t=t.filter((function(a,r,t){return r==t.indexOf(a)}));t.indexOf(null)>=0&&t.splice(t.indexOf(null),1);var e=this;var l=t.map((function(t){var l=i.changing({},a);l.list=l.list.filter((function(a){return a[r.name]==t}));var n=e.getBaseMatrix(l);n.caption=r.values?r.values[t].label:t;return n}));return l};Tabulator.prototype.toMatrix=function toMatrix(a){var r=i.changing({},a);var t=r.vars.filter((function(a){return a.isZ}))[0];r.vars.splice(r.vars.indexOf(t),1);var e=this.getBaseMatrix(a);e.z=t?this.getZMatrices(r,t):[i.changing({},e)];return e};Tabulator.prototype.getBaseMatrix=function getBaseMatrix(a){var r={left:{place:"lineVariables"},top:{place:"columnVariables"},data:{place:"dataVariables"}};var t={lineVariables:[],columnVariables:[],dataVariables:[],columns:[],lines:[],vars:{}};for(var e=0;e<a.vars.length;e++){var l=a.vars[e];t[r[l.place].place].push(l.name);t.vars[l.name]=l}t.oneColumnTitle=a.oneColumnTitle;var n={};var i={};for(var o=0;o<a.list.length;o++){var s;var u;var c=a.list[o];s=t.columnVariables.length;if(s>0){var v=[];v=t.columnVariables.map((function(a){return c[a]}));var f=JSON.stringify(v);if(n[f])s=n[f].index;else{s=t.columns.push({titles:v})-1;n[f]={index:s}}}var b=[];var p=[];for(var h=0;h<t.lineVariables.length;h++){b.push(c[t.lineVariables[h]]);p.push(c[t.dataVariables[h]])}var m=JSON.stringify(b);if(i[m])u=i[m].index;else{u=t.lines.push({titles:b,cells:[]})-1;i[m]={index:u}}var d={};a.showFunction&&(d.display=a.showFunction(c));for(var g=0;g<t.dataVariables.length;g++){var y=t.dataVariables[g];d[y]=c[y]}t.lines[u].cells[s]=d}for(var V=0;V<t.lines.length;V++)for(var w=0;w<t.columns.length;w++)void 0===t.lines[V].cells[w]&&(t.lines[V].cells[w]=null);return t};Tabulator.prototype.matrixJoin=function matrixJoin(a){this.controlsJoin(a);var r={columnGroups:[],lineVariables:[],lines:[],vars:{}};var t=a.map((function(a){return a.caption}));r.caption=t.join(this.matrixJoin.captionSeparator);var e=[];a.forEach((function(a){var r=a.lines;var t={};r.forEach((function(a){var r=JSON.stringify(a.titles);t[r]=a.cells}));e.push(t)}));r.columnGroups=a.map((function(a){var r={};r.columnVariables=a.columnVariables;r.columns=a.columns;return r}));r.lineVariables=a[0].lineVariables;r.lines=a[0].lines;r.vars=a[0].vars;a.forEach((function(a,t){if(t>0){r.lines.forEach((function(a,l){var n=e[t][JSON.stringify(a.titles)];r.lines[l].cells=r.lines[l].cells.concat(n)}));for(var l in a.vars)r.vars[l]=a.vars[l]}}));return r};Tabulator.prototype.matrixJoin.captionSeparator=", ";return Tabulator}));var n=l;export default n;

